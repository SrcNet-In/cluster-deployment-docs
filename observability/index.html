
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://srcnet-in.github.io/cluster-deployment-docs/observability/">
      
      
        <link rel="prev" href="../gateway-api/">
      
      
        <link rel="next" href="../logging/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>observability - Cluster Deployment Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="observability - Cluster Deployment Documentation" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://srcnet-in.github.io/cluster-deployment-docs/assets/images/social/observability.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://srcnet-in.github.io/cluster-deployment-docs/observability/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="observability - Cluster Deployment Documentation" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://srcnet-in.github.io/cluster-deployment-docs/assets/images/social/observability.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kubernetes-observability-tooling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cluster Deployment Documentation" class="md-header__button md-logo" aria-label="Cluster Deployment Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cluster Deployment Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              observability
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../terraform/" class="md-tabs__link">
        
  
    
  
  terrform

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../kepler/" class="md-tabs__link">
        
  
    
  
  kepler

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../gateway-api/" class="md-tabs__link">
        
  
    
  
  gateway-api

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  observability

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../logging/" class="md-tabs__link">
        
  
    
  
  logging

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cluster Deployment Documentation" class="md-nav__button md-logo" aria-label="Cluster Deployment Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Cluster Deployment Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../terraform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    terrform
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../kepler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kepler
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gateway-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gateway-api
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    observability
  </span>
  

      </a>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    logging
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<div><h1 id="kubernetes-observability-tooling"><strong>Kubernetes Observability Tooling</strong></h1>
<h1 id="tech-stack"><strong>Tech Stack</strong></h1>
<p>In our POC implementation for Kubernetes observability tooling for SRCNET Nodes, we have opted for the PLG stack—comprising of <strong>Prometheus</strong>, <strong>Loki</strong>, and <strong>Grafana</strong>—over the ELK stack (ElasticSearch, Logstash, and Kibana).</p>
<p>This stack offers the following features:</p>
<ol>
<li>
<p><strong>Kubernetes Native</strong>: The PLG stack is inherently designed for Kubernetes environments, offering seamless integration with Kubernetes-based workloads and configurations. This makes it a more natural choice for our observability needs within a Kubernetes cluster.</p>
</li>
<li>
<p><strong>Simple and Efficient</strong>: The PLG stack is known for its simplicity in setup and operation, while also being highly efficient in handling large volumes of data. It provides a streamlined approach to monitoring and logging, reducing complexity compared to the more generalized ELK stack.</p>
</li>
<li>
<p><strong>Scalable</strong>: PLG is designed with scalability in mind, which is crucial for managing large-scale Kubernetes deployments. As our observability needs grow, PLG's architecture can easily scale to accommodate increased traffic and data volume.</p>
</li>
<li>
<p><strong>Performent and Easy to Maintenance</strong>: In addition to its ease of use, the PLG stack offers high performance and low resource consumption, making it a better fit.</p>
</li>
</ol>
<hr>
<h3 id="list-of-tools"><strong>List of Tools</strong></h3>
<ol>
<li>Grafana</li>
<li>Prometheus</li>
<li>Loki</li>
<li>Alloy</li>
<li>Tempo</li>
<li>OpenTelemetry Collector</li>
</ol>
<hr>
<h3 id="grafana"><strong>Grafana</strong></h3>
<p>Grafana is an open-source tool used to create visual dashboards for monitoring and analyzing data. It connects to various data sources like Prometheus, Loki and helps you to visualize metrics in real-time. Grafana makes it easy to track performance and identify issues with interactive charts and graphs.</p>
<hr>
<h3 id="prometheus"><strong>Prometheus</strong></h3>
<p>Prometheus is a monitoring and alerting toolkit designed for Kubernetes and cloud-native environments. It collects and stores metrics (data on system performance) over time. Prometheus automatically scrapes data from your services and stores it in a time-series database.</p>
<hr>
<h3 id="grafana-loki"><strong>Grafana Loki</strong></h3>
<p>Loki is a log aggregation system designed for cloud-native environments, particularly Kubernetes. It efficiently collects, stores, and indexes logs from applications and services. Unlike traditional logging systems, Loki indexes logs by labels (such as application name, pod, or container), rather than the full content of each log line. This approach significantly reduces storage requirements and makes querying faster and more cost-effective.</p>
<hr>
<h3 id="grafana-alloy"><strong>Grafana Alloy</strong></h3>
<p>Grafana Alloy is an open-source distribution of the OpenTelemetry Collector, designed to streamline the collection, processing, and export of telemetry data—including metrics, logs, traces, and profiles—in environments like Kubernetes. It offers native support for both OpenTelemetry and Prometheus telemetry formats.</p>
<hr>
<h3 id="grafana-tempo"><strong>Grafana Tempo</strong></h3>
<p>Grafana Tempo is an open-source, high-scale distributed tracing backend. It enables efficient collection, storage, and analysis of trace data, providing valuable insights into the performance and reliability of distributed systems and it integrates nicely with grafana loki for logs and prometheus for metrics</p>
<hr>
<h3 id="opentelemetry-collector"><strong>OpenTelemetry Collector</strong></h3>
<p>The OpenTelemetry Collector is a vendor-agnostic tool designed to receive, process, and export telemetry data such as metrics, logs, and traces. When deployed within Kubernetes clusters, it enhances observability by collecting and managing telemetry data from various sources.</p>
<hr>
<h1 id="system-requirements"><strong>System Requirements</strong></h1>
<p>To set up the observability stack for SRCNodes, which includes Grafana, Prometheus, Loki, Tempo, Alloy, and OpenTelemetry Collector, ensure that the following hardware and software prerequisites are met.</p>
<h3 id="hardware-requirements"><strong>Hardware Requirements</strong></h3>
<p><strong>CPU:</strong> Minimum of 2 cores per node.​<br>
<strong>Memory:</strong> At least 2 GB of RAM per node<br>
<strong>Storage:</strong> 20 GB of free disk space per node.</p>
<p>* Prometheus and Loki will require disk space for storing time-series metrics and logs when they are stored locally instead of cloud services like S3 or GCS.<br>
* Tempo may also require significant storage depending on the retention period for traces.</p>
<h3 id="software-requirements"><strong>Software Requirements</strong></h3>
<p><strong>Kubernetes:</strong> 1.19 (or later)</p>
<p><strong>Helm:</strong> v3.x (or later)</p>
<hr>
<h1 id="architecture-overview"><strong>Architecture Overview</strong></h1>
<p><img alt="Image 1" src="../assets/images/image_1.png"></p>
<p>In our POC environment, we created two namespaces:</p>
<ol>
<li>
<p><strong>Monitoring Namespace</strong>: This namespace is dedicated to deploying the monitoring-related stack, including components such as <strong>Prometheus</strong>, <strong>Loki</strong>, <strong>Tempo</strong>, <strong>Alloy</strong> and <strong>Grafana</strong>.</p>
</li>
<li>
<p><strong>Services Namespace</strong>: This namespace is where our test service is deployed. It serves as the target for monitoring and observability tasks, allowing us to collect and visualize metrics, logs, and traces.</p>
</li>
</ol>
<p>The observability stack fullfills three requirments:</p>
<ul>
<li><strong>Metrics Collection</strong>: Metrics are fetched from <strong>Prometheus</strong> and visualized in <strong>Grafana</strong>.</li>
<li><strong>Log Aggregation</strong>: Logs are gathered by <strong>Loki</strong> and displayed in <strong>Grafana</strong>.</li>
<li><strong>Distributed Tracing</strong>: Traces are collected from <strong>Tempo</strong> and rendered in <strong>Grafana</strong>.</li>
</ul>
<hr>
<h3 id="metrics-collection"><strong>Metrics Collection</strong></h3>
<p>To capture metrics from services into Prometheus, there are several approaches. One method used in this architecture is <strong>Prometheus client integration</strong>.
The process involves the following steps:</p>
<ol>
<li><strong>Install Prometheus Client</strong>: The Prometheus client is installed within the service.</li>
<li><strong>Configure Metrics and Endpoint</strong>: The client is configured to collect the desired metrics and expose them via a dedicated endpoint.</li>
<li><strong>ServiceMonitor Creation</strong>: A ServiceMonitor resource is created to enable Prometheus to scrape the metrics at regular intervals.</li>
<li><strong>Data Storage</strong>: The collected metrics are stored in a Persistent Volume Claim (PVC) for durability.</li>
<li><strong>Grafana Integration</strong>: Prometheus is added as a data source to <strong>Grafana</strong>, which visualizes and presents the metrics.</li>
</ol>
<p>With this setup, Prometheus continuously scrapes the metrics from the service, and Grafana allows for real-time visualization of the data.</p>
<hr>
<h3 id="logs-aggregation"><strong>Logs Aggregation</strong></h3>
<p>To capture logs from services running within our Kubernetes cluster, we utilize <strong>Grafana Alloy</strong> in conjunction with <strong>Loki</strong> and <strong>Grafana</strong> for efficient log aggregation and visualization. The log collection and visualization process is as follows:</p>
<ol>
<li><strong>Deploy Grafana Alloy</strong>: Grafana Alloy is installed within the Kubernetes cluster to collect logs from the pods. It offers flexibility in log collection methods, including using the Kubernetes API to tail logs without requiring a DaemonSet</li>
<li><strong>Configure Log Collection</strong>: Alloy is configured to collect logs from specific pods or namespaces. This configuration involves setting up the appropriate components within Alloy to discover and tail logs from the desired sources.</li>
<li><strong>Forward Logs to Loki</strong>: The collected logs are forwarded to <strong>Loki</strong>, a log aggregation system designed for scalability and efficiency. Alloy's loki.write component handles the delivery of logs to Loki endpoints.</li>
<li><strong>Store Logs in Loki</strong>: Loki stores the logs in an object storage system or persistent volume, ensuring durability and facilitating efficient querying.</li>
<li><strong>Visualize Logs in Grafana</strong>: <strong>Grafana</strong> is configured to use Loki as a data source. This setup allows for the creation of dynamic dashboards and the execution of queries to analyze and visualize log data in real-time.</li>
</ol>
<hr>
<h3 id="distributed-tracing"><strong>Distributed Tracing</strong></h3>
<p>To implement distributed tracing within our Kubernetes environment, we utilize <strong>OpenTelemetry</strong> for instrumentation, the <strong>OpenTelemetry Collector</strong> for collecting and exporting trace data, and <strong>Grafana Tempo</strong> for storing and visualizing traces. The process is structured as follows:</p>
<ol>
<li>
<p><strong>Instrument Services with OpenTelemetry SDKs</strong>: Each service in the Services Namespace is instrumented using OpenTelemetry SDKs. This involves integrating the appropriate OpenTelemetry libraries into the application code to capture trace data, such as request paths, durations, and dependencies.</p>
</li>
<li>
<p><strong>Enable Auto-Instrumentation (Optional)</strong>: For languages and frameworks that support it, auto-instrumentation is enabled to automatically capture trace data without manual code modifications. This approach simplifies the instrumentation process and ensures consistent trace data collection across services.</p>
</li>
<li><strong>Deploy the OpenTelemetry Collector</strong>: The OpenTelemetry Collector is deployed within the Kubernetes cluster to receive, process, and export trace data. It acts as a telemetry gateway, collecting traces from instrumented services and forwarding them to the tracing backend.</li>
<li><strong>Configure the Collector to Export Traces to Grafana Tempo</strong>: The Collector is configured with exporters that send trace data to <strong>Grafana Tempo</strong>, our chosen tracing backend. This setup involves specifying the Tempo endpoint and ensuring that traces are transmitted securely and efficiently.</li>
<li><strong>Visualize Traces in Grafana</strong>: Grafana is configured to connect to Grafana Tempo as a data source. This integration allows for the creation of dashboards that visualize trace data, enabling the monitoring of request flows, identification of performance bottlenecks, and analysis of service dependencies.</li>
</ol>
<hr>
<h1 id="setting-up-the-plg-stack"><strong>Setting up the PLG Stack</strong></h1>
<h3 id="kube-prometheus-stack"><strong>kube-prometheus-stack:</strong></h3>
<p>To install the <code>kube-prometheus-stack</code> with customized configurations, follow these steps:</p>
<p><strong>1. Create a Monitoring Namespace:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>kubectl create namespace monitoring
</code></pre></div>
<p><strong>2. Add the Prometheus Community Helm Repository:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>helm repo update
</code></pre></div>
<p><strong>3. Fetch Default Values:</strong></p>
<p>Retrieve the default values of the <code>kube-prometheus-stack</code> Helm chart to customize them as needed:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>helm show values prometheus-community/kube-prometheus-stack &gt; values.yaml
</code></pre></div>
<p>This command saves the default values to a <code>values.yaml</code> file, which you can edit to tailor the installation to your requirements.</p>
<p><strong>4. Customize values.yaml</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>prometheus:
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>  prometheusSpec:
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    storageSpec:
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>      volumeClaimTemplate:
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        metadata:
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>          name: prometheus-pvc
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        spec:
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>          accessModes:
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>            - ReadWriteOnce
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>          resources:
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>            requests:
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>              storage: 10Gi
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>          storageClassName: nfs-default
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    retention: "720h"  # 30 days retention (720 hours)
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>    namespaceSelector: {}
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>grafana:
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>  persistence:
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>    enabled: true
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>    size: 5Gi
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>    storageClassName: nfs-default
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>alertmanager:
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>  alertmanagerSpec:
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>    storage:
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>      volumeClaimTemplate:
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>        metadata:
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>          name: alertmanager-pvc
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>        spec:
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>          accessModes:
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>            - ReadWriteOnce
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>          resources:
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>            requests:
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>              storage: 5Gi
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>          storageClassName: nfs-default
</code></pre></div>
<p><strong>5. Install the <code>kube-prometheus-stack</code> Helm Chart:</strong></p>
<p>With your customized <code>values.yaml</code>, install the Helm chart in the <code>monitoring</code> namespace:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>helm install kube-prometheus-stack prometheus-community/kube-prometheus-stack -n monitoring -f values.yaml
</code></pre></div>
<p><strong>6. Set Up Gateway API Resources for Grafana Access:</strong></p>
<p>To access the Grafana dashboard via the Gateway API, define <code>Gateway</code> and <code>HTTPRoute</code> resources.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>apiVersion: gateway.networking.k8s.io/v1
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>kind: Gateway
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>metadata:
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>  name: envoy-grafana-gateway
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>spec:
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>  gatewayClassName: envoy-gateway-class
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>  listeners:
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>  - name: grafana-gateway-http-envoy
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    protocol: HTTP
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    port: 80
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    allowedRoutes:
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>        namespaces:
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>          from: All
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>  - name: grafana-gateway-https-envoy
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    protocol: HTTPS
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>    port: 443
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>    allowedRoutes:
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>        namespaces:
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>          from: All
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>    hostname: "grafana.e4r.internal"
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>    tls:
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>      certificateRefs:
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>      - kind: Secret
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>        group: ""
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>        name: grafana-gateway-tls
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>---
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>apiVersion: gateway.networking.k8s.io/v1
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>kind: HTTPRoute
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>metadata:
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>  name: grafana
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>  namespace: monitoring
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>spec:
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>  parentRefs:
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>    - name: envoy-grafana-gateway # Updated to use the new monitoring-gateway
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>      namespace: default         # Ensure the gateway is in the monitoring namespace
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>  hostnames:
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>    - "grafana.e4r.internal"
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>  rules:
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>    - matches:
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>        - path:
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a>            type: PathPrefix
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a>            value: /
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>      backendRefs:
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>        - name: prometheus-stack-grafana
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>          port: 80
</code></pre></div>
<p><strong>7. Apply the Gateway API Resources and access the Grafana Dashboard</strong><br>
 After applying the Gateway API resources, access the Grafana dashboard at <code>https://grafana.e4r.internal/grafana</code>. The default login credentials are:</p>
<p><strong>Username: <code>admin</code></strong><br>
<strong>Password: <code>prom-operator</code></strong></p>
<hr>
<h3 id="grafana-tools"><strong>Grafana Tools:</strong></h3>
<div class="highlight"><pre><span></span><code>To install the Grafana tools with customized configurations, follow these steps
</code></pre></div>
<p><strong>1. Add the Grafana Helm Repository:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>helm repo add grafana https://grafana.github.io/helm-charts
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>helm repo update
</code></pre></div>
<p><strong>2. Grafana Loki:</strong></p>
<p>There are three different ways of deploying the Grafana Loki, they are</p>
<ol>
<li>Monolithic</li>
<li>Simple Scalable</li>
<li>Microservice</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a> helm show values grafana/loki &gt; values.yaml
</code></pre></div>
<p>This command saves the default values to a <code>values.yaml</code> file, which you can edit to tailor the installation to your requirements.<br>
Customise the values.yaml according to your requirements and in this case, we are installing a simple monolithic version of loki and the values.yaml looks like this</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>loki:
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>  auth_enabled: false
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>  commonConfig:
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    replication_factor: 1
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>  schemaConfig:
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    configs:
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>      - from: "2025-04-01"
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>        store: tsdb
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>        object_store: s3
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>        schema: v13
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>        index:
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>          prefix: loki_index_
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>          period: 24h
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>  pattern_ingester:
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>      enabled: true
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>  limits_config:
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>    allow_structured_metadata: true
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    volume_enabled: true
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>  ruler:
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>    enable_api: true
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>minio:
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>  enabled: true
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>deploymentMode: SingleBinary
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>singleBinary:
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>  replicas: 1
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>backend:
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>  replicas: 0
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>read:
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>  replicas: 0
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>write:
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>  replicas: 0
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>ingester:
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>  replicas: 0
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>querier:
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>  replicas: 0
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>queryFrontend:
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>  replicas: 0
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>queryScheduler:
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>  replicas: 0
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>distributor:
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>  replicas: 0
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>compactor:
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>  replicas: 0
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>indexGateway:
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a>  replicas: 0
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>bloomCompactor:
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a>  replicas: 0
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a>bloomGateway:
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>  replicas: 0
</code></pre></div>
<p>Now, we install the Grafana loki with these values as we are willing to deploy it as simple monolithic application in monitoring namespace.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>helm install loki grafana/loki -n monitoring -f values.yaml
</code></pre></div>
<p>Now Select the Data source from Connections in the sidebar in the Grafana dashboard and add loki data source and configure it with loki url which is <strong><a href="http://loki.monitoring.svc.cluster.local:3100">http://loki.monitoring.svc.cluster.local:3100</a></strong><br>
In our case, add authentication methods if configured to the Loki and save it.</p>
<p><img alt="image2" src="../assets/images/image_2.png"></p>
<p><strong>3. Grafana Alloy:</strong></p>
<p>Installing Alloy using helm is straightforward.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a> helm show values grafana/alloy &gt; values.yaml
</code></pre></div>
<p>This command saves the default values to a <code>values.yaml</code> file, which you can edit to tailor the installation to your requirements.<br>
Customise the values.yaml according to your requirements and in this case</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>alloy:
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>  configMap:
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    content: |-
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>      loki.write "default" {
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>        endpoint {
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>          url = "http://loki.monitoring:3100/loki/api/v1/push"
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>        }
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>      }
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>      discovery.kubernetes "pod" {
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>        role = "pod"
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>      }
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>      discovery.relabel "pod_logs" {
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>        targets = discovery.kubernetes.pod.targets
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>        rule {
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>          source_labels = ["__meta_kubernetes_namespace"]
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>          action        = "replace"
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>          target_label  = "namespace"
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>        }
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>        rule {
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>          source_labels = ["__meta_kubernetes_pod_name"]
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>          action        = "replace"
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>          target_label  = "pod"
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>        }
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>        rule {
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>          source_labels = ["__meta_kubernetes_pod_container_name"]
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>          action        = "replace"
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>          target_label  = "container"
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>        }
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>        rule {
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>          source_labels = ["__meta_kubernetes_pod_label_app_kubernetes_io_name"]
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>          action        = "replace"
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>          target_label  = "app"
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>        }
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>        rule {
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>          source_labels = ["__meta_kubernetes_namespace", "__meta_kubernetes_pod_container_name"]
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>          action        = "replace"
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>          target_label  = "job"
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>          separator     = "/"
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>          replacement   = "$1/$2"
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>        }
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>        rule {
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a>          source_labels = ["__meta_kubernetes_pod_uid", "__meta_kubernetes_pod_container_name"]
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>          action        = "replace"
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a>          target_label  = "__path__"
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>          separator     = "/"
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>          replacement   = "/var/log/pods/*$1/*.log"
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a>        }
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a>        rule {
<a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a>          source_labels = ["__meta_kubernetes_pod_container_id"]
<a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a>          action        = "replace"
<a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a>          target_label  = "container_runtime"
<a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a>          regex         = "^(\\S+):\\/\\/.+$"
<a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a>          replacement   = "$1"
<a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a>        }
<a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a>      }
<a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a>
<a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a>      loki.source.kubernetes "pod_logs" {
<a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a>        targets    = discovery.relabel.pod_logs.output
<a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a>        forward_to = [loki.process.pod_logs.receiver]
<a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a>      }
<a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a>
<a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a>      loki.process "pod_logs" {
<a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a>        stage.static_labels {
<a id="__codelineno-11-66" name="__codelineno-11-66" href="#__codelineno-11-66"></a>          values = {
<a id="__codelineno-11-67" name="__codelineno-11-67" href="#__codelineno-11-67"></a>            cluster = "kubernetes",
<a id="__codelineno-11-68" name="__codelineno-11-68" href="#__codelineno-11-68"></a>          }
<a id="__codelineno-11-69" name="__codelineno-11-69" href="#__codelineno-11-69"></a>        }
<a id="__codelineno-11-70" name="__codelineno-11-70" href="#__codelineno-11-70"></a>        forward_to = [loki.write.default.receiver]
<a id="__codelineno-11-71" name="__codelineno-11-71" href="#__codelineno-11-71"></a>      }
</code></pre></div>
<p>Alloy does these things in our case</p>
<ol>
<li>Define Loki Write Endpoint</li>
<li>Enable Kubernetes Pod Discovery</li>
<li>Configure Relabeling for Log Metadata</li>
<li>Define Log Source from Kubernetes Pods</li>
<li>Process Logs Before Writing</li>
</ol>
<p>In order to easily configure the alloy with various components Grafana Alloy has a open source tool, <a href="https://grafana.github.io/alloy-configurator/">https://grafana.github.io/alloy-configurator/</a> <strong>[ Alloy Configurator ]</strong></p>
<p>Now, we install the Grafana alloy with these values in the monitoring namespace.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>helm install alloy grafana/alloy -n monitoring -f values.yaml
</code></pre></div>
<p>Grafana Alloy also provides a UI dashboard which should look like this and helps to verify if it’s configured properly.</p>
<p><img alt="image3" src="../assets/images/image_3.png"></p>
<p><strong>4. Grafana Tempo:</strong></p>
<p>Grafana Tempo can be installed using Helm, and tracing information can then be provided to it via Grafana Alloy from the services. Optionally, we can install and set up an OpenTelemetry Collector to capture the instrumentation data, which would then be sent to Grafana Alloy. This approach adds an additional step in the pipeline, allowing us to decouple the tracing process or add more flexibility in how traces are fetched from services to Tempo</p>
<p>We need to install Grafana Tempo and update the values of Grafana Alloy to enable the capture of traces from services and write them to Tempo. Afterward, we must add Grafana Tempo as a data source in the Grafana dashboard.</p>
<p><strong>Installing Grafana Tempo</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>helm install tempo grafana/tempo -n monitoring -f tempo-values.yaml
</code></pre></div>
<p>Now update the <strong>values.yaml</strong> of Grafana Alloy to allow it to collect and send traces to Tempo, which looks like this,</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>alloy:
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>  extraPorts:
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    - name: "grpc"
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>      port: 4317
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>      targetPort: 4317
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>      protocol: "TCP"
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>  configMap:
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    content: |-
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>      ... previous config
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>      otelcol.exporter.otlp "tempoExporter" {
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>        client {
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>          endpoint = "tempo.monitoring.svc.cluster.local:4317"
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>          tls {
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>            insecure = true
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>          }
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>        }
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>      }
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>      otelcol.connector.servicegraph "default" {
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>        dimensions = ["http.method", "http.target"]
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>        output {
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>          metrics = [otelcol.exporter.otlp.tempoExporter.input]
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>        }
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>      }
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>      otelcol.receiver.otlp "defaultReceiver" {
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>        grpc {
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>          endpoint = ":4317"
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>        }
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>        output {
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>          traces = [
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>            otelcol.exporter.otlp.tempoExporter.input,
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>         otelcol.connector.servicegraph.default.input,
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>          ]
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>        }
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>      }
</code></pre></div>
<p>This configuration allows alloy to collect and send instrumentation data from services to grafana tempo.<br>
Now we have to helm upgrade alloy and we should be able to see the new Alloy dashboard graph like this.<br>
<img alt="image4" src="../assets/images/image_4.png"></p>
<p>Now Select the Data source from Connections in the sidebar in the Grafana dashboard and add Tempo data source and configure it with loki url which is <strong><a href="http://loki.monitoring.svc.cluster.local:3100">http://tempo.monitoring.svc.cluster.local:3100</a></strong><br>
In our case, add authentication methods if configured to the Loki and save it.<br>
Also add the trace to logs and trace to metrics data sources, which can be Grafana Loki and Prometheus for trace to metrics and save it.</p>
<p><img alt="image5" src="../assets/images/image_5.png"></p>
<hr>
<h1 id="sample-service-with-prometheus-and-opentelemetry-sdk"><strong>Sample Service with Prometheus and OpenTelemetry SDK</strong></h1>
<p>In the current implementation, logs can be automatically populated with the help of Grafana Alloy. However, for metrics and tracing, we need to install and configure from the respective libraries. To avoid code-level changes, we considered alternatives such as auto-instrumentation for tracing and a sidecar approach, or other alternatives for metrics. For now, we have created two test services in FastAPI (Python) and NodeJs (Javascript) that have Prometheus and OpenTelemetry clients installed. These services will capture metrics and logs and send them to Prometheus and Tempo, respectively.</p>
<p><strong>Test App for Metrics</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"express"</span><span class="p">);</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"http"</span><span class="p">);</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">promClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"prom-client"</span><span class="p">);</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">collectDefaultMetrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">promClient</span><span class="p">.</span><span class="nx">collectDefaultMetrics</span><span class="p">;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="nx">collectDefaultMetrics</span><span class="p">({</span><span class="w"> </span><span class="nx">register</span><span class="o">:</span><span class="w"> </span><span class="nx">promClient</span><span class="p">.</span><span class="nx">register</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="kd">const</span><span class="w"> </span><span class="nx">apiHits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">promClient</span><span class="p">.</span><span class="nx">Counter</span><span class="p">({</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"api_hits"</span><span class="p">,</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">  </span><span class="nx">help</span><span class="o">:</span><span class="w"> </span><span class="s2">"Number of hits to the API"</span><span class="p">,</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="p">});</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="kd">const</span><span class="w"> </span><span class="nx">httpRequests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">promClient</span><span class="p">.</span><span class="nx">Counter</span><span class="p">({</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"http_requests"</span><span class="p">,</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">  </span><span class="nx">help</span><span class="o">:</span><span class="w"> </span><span class="s2">"Number of HTTP requests"</span><span class="p">,</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">  </span><span class="nx">labelNames</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"route"</span><span class="p">,</span><span class="w"> </span><span class="s2">"method"</span><span class="p">,</span><span class="w"> </span><span class="s2">"status"</span><span class="p">],</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="p">});</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">3000</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Server is running on port 3000"</span><span class="p">);</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="p">});</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/fast"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">  </span><span class="nx">apiHits</span><span class="p">.</span><span class="nx">inc</span><span class="p">();</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">  </span><span class="nx">httpRequests</span><span class="p">.</span><span class="nx">inc</span><span class="p">({</span><span class="w"> </span><span class="nx">route</span><span class="o">:</span><span class="w"> </span><span class="s2">"/fast"</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="p">,</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"This is a fast request hit!"</span><span class="p">);</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">"This is a fast request!"</span><span class="p">);</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"An error occurred!"</span><span class="p">);</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">500</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="s2">"An error occurred!"</span><span class="p">);</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="p">});</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/slow"</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="w">  </span><span class="nx">apiHits</span><span class="p">.</span><span class="nx">inc</span><span class="p">();</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="w">  </span><span class="nx">httpRequests</span><span class="p">.</span><span class="nx">inc</span><span class="p">({</span><span class="w"> </span><span class="nx">route</span><span class="o">:</span><span class="w"> </span><span class="s2">"/slow"</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="p">,</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"This is a slow request hit!"</span><span class="p">);</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">3000</span><span class="p">));</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">"This is a slow request!"</span><span class="p">);</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"An error occurred!"</span><span class="p">);</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">500</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="s2">"An error occurred!"</span><span class="p">);</span>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="p">});</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/metrics"</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"This is a metrics request hit!"</span><span class="p">);</span>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">promClient</span><span class="p">.</span><span class="nx">register</span><span class="p">.</span><span class="nx">metrics</span><span class="p">();</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">"Content-Type"</span><span class="p">,</span><span class="w"> </span><span class="nx">promClient</span><span class="p">.</span><span class="nx">register</span><span class="p">.</span><span class="nx">contentType</span><span class="p">);</span>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">metrics</span><span class="p">);</span>
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a><span class="p">});</span>
</code></pre></div>
<p>When deploying this service make sure to add a ServiceMonitor in order to allow Prometheus to scrape the metrics from the service periodically</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>apiVersion: monitoring.coreos.com/v1
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>kind: ServiceMonitor
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>metadata:
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>  name: k8s-app-http
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>  namespace: services
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>  labels:
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    release: prometheus-stack
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>spec:
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>  selector:
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>    matchLabels:
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>      app: test-app
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>  endpoints:
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>  - port: http-metrics
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>    path: /metrics
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>    interval: 15s
</code></pre></div>
<p><strong>Test App for Tracing</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">http.client</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastAPI</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.instrumentation.fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastAPIInstrumentor</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.sdk.trace</span><span class="w"> </span><span class="kn">import</span> <span class="n">TracerProvider</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.sdk.resources</span><span class="w"> </span><span class="kn">import</span> <span class="n">Resource</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.sdk.trace.export</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchSpanProcessor</span><span class="p">,</span> <span class="n">ConsoleSpanExporter</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.exporter.otlp.proto.grpc.trace_exporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">OTLPSpanExporter</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">'opentelemetry'</span><span class="p">)</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="n">resource</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">(</span><span class="n">attributes</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>    <span class="s2">"service.name"</span><span class="p">:</span> <span class="s2">"test-api-service"</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="p">})</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="n">provider</span> <span class="o">=</span> <span class="n">TracerProvider</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">)</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="n">otel_endpoint_url</span> <span class="o">=</span> <span class="s2">"http://otel-collector-opentelemetry-collector.monitoring.svc.cluster.local:4317"</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="k">if</span> <span class="n">otel_endpoint_url</span><span class="p">:</span>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>    <span class="n">otlp_exporter</span> <span class="o">=</span> <span class="n">OTLPSpanExporter</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="n">otel_endpoint_url</span><span class="p">)</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>    <span class="n">processor</span> <span class="o">=</span> <span class="n">BatchSpanProcessor</span><span class="p">(</span><span class="n">otlp_exporter</span><span class="p">)</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>    <span class="n">processor</span> <span class="o">=</span> <span class="n">BatchSpanProcessor</span><span class="p">(</span><span class="n">ConsoleSpanExporter</span><span class="p">())</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="n">provider</span><span class="o">.</span><span class="n">add_span_processor</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="n">trace</span><span class="o">.</span><span class="n">set_tracer_provider</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_tracer</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="n">FastAPIInstrumentor</span><span class="o">.</span><span class="n">instrument_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a>
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a><span class="n">FAST_API_HOST</span> <span class="o">=</span> <span class="s2">"test-app.services.svc.cluster.local"</span>
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="n">SLOW_API_HOST</span> <span class="o">=</span> <span class="s2">"test-app.services.svc.cluster.local"</span>
<a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="n">FAST_API_PORT</span> <span class="o">=</span> <span class="mi">3000</span>
<a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a><span class="n">SLOW_API_PORT</span> <span class="o">=</span> <span class="mi">3000</span>
<a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>
<a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/fast"</span><span class="p">)</span>
<a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fast_endpoint</span><span class="p">():</span>
<a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a>    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">"fast_operation"</span><span class="p">):</span>
<a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Fast request started"</span><span class="p">)</span>
<a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a>        <span class="n">conn</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">FAST_API_HOST</span><span class="p">,</span> <span class="n">FAST_API_PORT</span><span class="p">)</span>
<a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"/fast"</span><span class="p">)</span>
<a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"API call to test service started"</span><span class="p">)</span>
<a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
<a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"API call to test service ended"</span><span class="p">)</span>
<a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Fast request completed"</span><span class="p">)</span>
<a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Fast response"</span><span class="p">}</span>
<a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a>
<a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/slow"</span><span class="p">)</span>
<a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">slow_endpoint</span><span class="p">():</span>
<a id="__codelineno-17-61" name="__codelineno-17-61" href="#__codelineno-17-61"></a>    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">"slow_operation"</span><span class="p">):</span>
<a id="__codelineno-17-62" name="__codelineno-17-62" href="#__codelineno-17-62"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Slow request started"</span><span class="p">)</span>
<a id="__codelineno-17-63" name="__codelineno-17-63" href="#__codelineno-17-63"></a>        <span class="n">conn</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">SLOW_API_HOST</span><span class="p">,</span> <span class="n">SLOW_API_PORT</span><span class="p">)</span>
<a id="__codelineno-17-64" name="__codelineno-17-64" href="#__codelineno-17-64"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"/slow"</span><span class="p">)</span>
<a id="__codelineno-17-65" name="__codelineno-17-65" href="#__codelineno-17-65"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"API call to test service started"</span><span class="p">)</span>
<a id="__codelineno-17-66" name="__codelineno-17-66" href="#__codelineno-17-66"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<a id="__codelineno-17-67" name="__codelineno-17-67" href="#__codelineno-17-67"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
<a id="__codelineno-17-68" name="__codelineno-17-68" href="#__codelineno-17-68"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-17-69" name="__codelineno-17-69" href="#__codelineno-17-69"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"API call to test service ended"</span><span class="p">)</span>
<a id="__codelineno-17-70" name="__codelineno-17-70" href="#__codelineno-17-70"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-17-71" name="__codelineno-17-71" href="#__codelineno-17-71"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Slow request completed"</span><span class="p">)</span>
<a id="__codelineno-17-72" name="__codelineno-17-72" href="#__codelineno-17-72"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Slow response"</span><span class="p">}</span>
<a id="__codelineno-17-73" name="__codelineno-17-73" href="#__codelineno-17-73"></a>
<a id="__codelineno-17-74" name="__codelineno-17-74" href="#__codelineno-17-74"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
<a id="__codelineno-17-75" name="__codelineno-17-75" href="#__codelineno-17-75"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">uvicorn</span>
<a id="__codelineno-17-76" name="__codelineno-17-76" href="#__codelineno-17-76"></a>    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">"0.0.0.0"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
</code></pre></div>
<hr>
<h1 id="official-docs-and-helm-charts"><strong>Official Docs and Helm Charts</strong></h1>
<ul>
<li><a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack">https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack</a></li>
<li><a href="https://github.com/grafana/helm-charts/">https://github.com/grafana/helm-charts/</a></li>
<li><a href="https://github.com/open-telemetry/opentelemetry-helm-charts/tree/main/charts/opentelemetry-collector">https://github.com/open-telemetry/opentelemetry-helm-charts/tree/main/charts/opentelemetry-collector</a></li>
<li><a href="https://grafana.com/docs/tempo/latest/getting-started/">https://grafana.com/docs/tempo/latest/getting-started/</a></li>
<li><a href="https://grafana.com/docs/alloy/latest/">https://grafana.com/docs/alloy/latest/</a></li>
<li><a href="https://grafana.com/docs/loki/latest/">https://grafana.com/docs/loki/latest/</a></li>
</ul></div>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2025 <a href="https://srcnet-in.github.io"  target="_blank" rel="noopener">SRC Net Indigo Team</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/srcnet-in" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/srcnet-in" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/srcnet-in" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>